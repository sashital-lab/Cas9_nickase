# other requests

* 2020/04/09
* /work/gif/severin/sashital-lab/2020_cas9-cas12amod/cas9_merge/04_other

#### Grab all the mm-stats.txt files

```
# first make folders for each library
mkdir 002
```

```
cd 002
ls /work/gif/severin/sashital-lab/2020_cas9-cas12amod/cas9_merge/02_analysis/002/mismatches-table/*mm-stats.txt | xargs -I xx ln -s xx
```

This will create the input files that will need to be used to run the position summary part of the KM02.sh script

```
for i in 1 2 3 4 5 6
do
#this second for loop grabs the reads and generates the input file
  for file in *_mm-stats.txt
  do
  echo ${file}_${i}
  awk '$2=="'$i'" {print $1}' $file | sed -e 's/\(.\)/\1\t/g' > ${file}_${i}
  done
done
```

## separate out by number of snps


Will want to create separate folders for each number of SNPs ie (position-matrix_1 position-matrix_2 ... position-matrix_6)

```
mkdir position-matrix_1 position-matrix_2 position-matrix_3 position-matrix_4 position-matrix_5 position-matrix_6
mv *_1 position-matrix_1
mv *_2 position-matrix_2
mv *_3 position-matrix_3
mv *_4 position-matrix_4
mv *_5 position-matrix_5
mv *_6 position-matrix_6
```

## Position summaries for 002

This will create the position summaries

```
#run this in each of the folders to create new position summary.txt files

# generate positional frequency matrix
# requires datamash
# module load datamash

export PATH=$PATH:/work/gif/severin/isugif/software/datamash-1.3/bin/
string="GGAAATTAGGTGCGCTTGGC"

for i in 1 2 3 4 5 6
do
  echo "position-matrix_${i}"
  cd position-matrix_${i}
    for file in *_${i}
    do
      header=$(echo $string | sed -e 's/\(.\)/\1\t/g')
      echo -e "${file%.*}\t${header}" > ${file%.*}_pos-summary.txt
        for i in {1..20}; do
          datamash -s groupby $i count $i  < ${file}  |\
          grep -v "^N" | \
          cut -f 2 |\
          paste - - - - ;
        done |\
      datamash transpose |\
      paste <(echo -e "A\nC\nG\nT") - >>  ${file%.*}_pos-summary.txt
    done
 cd ..
done

```


### Combining files

Once all the position summary files are created then I can run a cat on each of the folders to reduce the number of files for the supplementary tables.  

```
ls *.txt  | perl -pe 's/_/ /g' | perl -pe 's/-/ /g' | awk '{print $1}' | sort | uniq -c
      6 002
     24 HF1
     24 Hypa
     24 IDT
     32 Sa
     44 Sp


ls *.txt  | perl -pe 's/_/ /g' | perl -pe 's/-/ /g'  | awk '{print $3}' | sort | uniq -c
50 rep1
62 rep2
22 rep3
20 rep4R
```

```

for i in 1 2 3 4 5 6
do
  echo "position-matrix_${i}"
  cd position-matrix_${i}

      for library in HF1 Hypa IDT Sa Sp
      do
        for ID in rep1 rep2 rep3 rep4R
        do
        cat *${library}*${ID}*_pos-summary.txt  > full_${library}_${ID}.txt
        done
      done
  cd ..
done
```

```
for i in 1 2 3 4 5 6
do
  echo "position-matrix_${i}"
  cd position-matrix_${i}

      for library in 001_ 002_
      do
        for ID in rep1 rep2 rep3
        do
        cat ${library}*${ID}*_pos-summary.txt  > full_${library}_${ID}.txt
        done
      done
  cd ..
done
```

Remove empty files as those replicates don't exist but were generated by for loop

```
ls -lha */full*  | awk '$5==0 {print $NF}' | xargs -I xx rm xx
```

## Rsync over the files to LSS

```
 rsync -av /work/gif/severin/sashital-lab/2020_cas9-cas12amod/cas9_merge /lss/research/sashital-lab/Karthik/ISUGIF/2020_cas12aNickase/cas9_merge
 ```

 ```
 rsync -av /work/gif/severin/sashital-lab/2020_cas9-cas12amod/cas9_merge /lss/research/sashital-lab/Karthik/ISUGIF/2020_cas12aNickase/cas9_merge
 ```
